webpackJsonp([35],{216:function(s,e,i){var t,n;t=[i(0),i(1),i(9),i(2)],void 0!==(n=function(s,e,i,t){"use strict";return s.Class.declare({$name:"FocusHandler",_page:null,_applyAnimations:!1,_gainFocusMargin:0,_loseFocusMargin:0,_gainFocusMarginFactor:.3,_loseFocusMarginFactor:.2,_focusedQuestion:null,_disqualified:[".Meta",".Timing",".Captcha"],_enabled:!0,_forceFocus:!1,_forceFocusTimeout:500,_disableMouseHover:!1,_disableMouseHoverTimeout:1250,_lastClientX:null,_lastClientY:null,_scrollingDown:!1,_lastScrollY:0,_getDisqualified:function(){return this._disqualified.join(",")},initialize:function(s,e){this._page=s,this._applyAnimations=e,this._setMarginAndRefocus()},setupInitialFocus:function(){if(this._enabled){this._page.resetAutoadvanceButtonDisplay(),this.clearFocusClasses(),this.clearFocusAnimationClasses(),this._focusedQuestion=this._page.findElementsOnPage("div.QuestionOuter:not(.hidden,"+this._getDisqualified()+"):first"),this._page.findElementsOnPage("div.QuestionOuter").off(".FocusHandler").on("mouseenter.FocusHandler mousemove.FocusHandler",function(s){s.clientX===this._lastClientX&&s.clientY===this._lastClientY||(this._readyForMouseHover()&&this._checkFocus(),this._lastClientX=s.clientX,this._lastClientY=s.clientY)}.$bind(this)),this._page.findElementsOnPage("input, textarea, select").off(".FocusHandler").on("focus.FocusHandler click.FocusHandler",function(s){var i=e(s.target).parents(".QuestionOuter")[0];i&&i.id&&this.forceFocus(i.id)}.$bind(this));var s=this._page.findElementsOnPage("div.QuestionOuter:not(.hidden,"+this._getDisqualified()+"):not(:first)"),i=this._page.findElementsOnPage("div.QuestionOuter.hidden:not("+this._getDisqualified()+")");this._applyAnimations&&(this._focusedQuestion.addClass("animatedFocused"),s.addClass("animatedUnfocused"),i.addClass("animatedUnfocused")),this._page.shouldAutoadvance()&&(this._focusedQuestion.addClass("questionFocused"),s.addClass("questionUnfocused"),i.addClass("questionUnfocused")),this._setMarginAndRefocus()}},bind:function(){e(i).on("scroll",function(){this._scrollingDown=e(i).scrollTop()>this._lastScrollY,this._lastScrollY=e(i).scrollTop(),this._checkFocus()}.$bind(this)),e(i).on("resize",function(){this._setMarginAndRefocus()}.$bind(this))},_swapFocus:function(s){if(s&&this._enabled&&s.hasClass("QuestionOuter")){s.length&&this._disqualified.map(function(e){return!s.hasClass(e.substring(1))}).reduce(function(s,e){return s&&e},!0)&&(this._focusedQuestion&&this._focusedQuestion.length&&s[0].id!=this._focusedQuestion[0].id&&this._swapFocusClasses(s),this._focusedQuestion=s)}},_swapFocusClasses:function(s){s&&(this._applyAnimations&&(s.removeClass("animatedUnfocused"),s.addClass("animatedFocused")),this._page.shouldAutoadvance()&&(s.removeClass("questionUnfocused"),s.addClass("questionFocused"))),this._focusedQuestion&&(this._applyAnimations&&(this._focusedQuestion.removeClass("animatedFocused"),this._focusedQuestion.addClass("animatedUnfocused")),this._page.shouldAutoadvance()&&(this._focusedQuestion.removeClass("questionFocused"),this._focusedQuestion.addClass("questionUnfocused")))},_focusViewportTop:function(){var s=e(),i=-1,n=this._page.findElementsOnPage("div.QuestionOuter:not(.hidden,"+this._getDisqualified()+")");return t.each(n,function(t,n){if(s.length||!t.getBoundingClientRect)return!1;var o=t.getBoundingClientRect();o.top<=this._gainFocusMargin&&o.bottom>=this._gainFocusMargin&&(s=e(t),i=parseInt(n))},this,!1),s.length&&s.find(".QuestionBody")[0].getBoundingClientRect().bottom<this._loseFocusMargin&&n.length>i+1&&(s=n.eq(i+1)),s},_setMarginAndRefocus:function(){this._gainFocusMargin=e(i).height()*this._gainFocusMarginFactor,this._loseFocusMargin=e(i).height()*this._loseFocusMarginFactor,this._checkFocus()},enable:function(){this._enabled=!0},disable:function(){this._enabled=!1},enableAnimations:function(){this._applyAnimations=!0},disableAnimations:function(){this._applyAnimations=!1},forceFocus:function(s){var e=this._page.findElementsOnPage("#"+s);this._forceFocus=+new Date,this._swapFocus(e)},disableMouseHover:function(){this._disableMouseHover=+new Date},_readyForMouseHover:function(s){return!!this._page.shouldAutofocusOnHover()&&(!(this._disableMouseHover&&s-this._disableMouseHover<this._disableMouseHoverTimeout)&&(this._disableMouseHover&&(this._disableMouseHover=!1),!0))},_nextQuestionInFocus:function(s){var e=s&&s.nextAll(".QuestionOuter");return this._focusedQuestion&&e.length&&this._focusedQuestion[0].id===e[0].id},_checkFocus:function(){if(this._enabled&&this._focusedQuestion){var s=+new Date;if(!(this._forceFocus&&s-this._forceFocus<this._forceFocusTimeout)){this._forceFocus&&(this._forceFocus=!1);var e=this._readyForMouseHover(s)&&this._page.findElementsOnPage("div.QuestionOuter:hover");(e&&e.length||!this._page.shouldAutofocusOnScroll()||(e=this._focusViewportTop(),!this._scrollingDown||!this._nextQuestionInFocus(e)))&&this._swapFocus(e)}}},clearFocusClasses:function(){var s=this._page.findElementsOnPage("div.QuestionOuter");s.removeClass("questionUnfocused"),s.removeClass("questionFocused")},clearFocusAnimationClasses:function(){var s=this._page.findElementsOnPage("div.QuestionOuter");s.removeClass("animatedUnfocused"),s.removeClass("animatedFocused")}})}.apply(e,t))&&(s.exports=n)}});